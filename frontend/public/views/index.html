<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Treinador Pro - Dashboard</title>
    <link rel="stylesheet" href="/frontend/public/css/main.css" />
  </head>
  <body>
    <header>
      <h1>Treinador Pro</h1>
      <nav>
        <a href="/">Dashboard</a>
        <a href="/views/cadastro.html">Novo Aluno</a>
      </nav>
    </header>
    <main>
      <div class="card">
        <h2>Lista de Alunos</h2>
        <table id="tabela-alunos">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Ação</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </main>

    <script>
      // CRÍTICO: Define a URL da API dinamicamente
      const API_BASE_URL = window.location.origin;
      const API_URL = `${API_BASE_URL}/api/alunos`;

      async function listarAlunos() {
        const tbody = document
          .getElementById("tabela-alunos")
          .querySelector("tbody");
        tbody.innerHTML = '<tr><td colspan="3">Carregando...</td></tr>';
        try {
          const response = await fetch(API_URL);
          const alunos = await response.json();
          tbody.innerHTML = "";
          if (alunos.length === 0) {
            tbody.innerHTML =
              '<tr><td colspan="3">Nenhum aluno cadastrado.</td></tr>';
            return;
          }
          alunos.forEach((aluno) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                        <td>${aluno.nome}</td>
                        <td>${aluno.email || "-"}</td>
                        <td><a href="/views/aluno.html?id=${
                          aluno.id
                        }" class="btn-acao">Acompanhar / Planilha</a></td>
                    `;
            tbody.appendChild(tr);
          });
        } catch (error) {
          tbody.innerHTML =
            '<tr><td colspan="3">Erro ao carregar alunos. Verifique a conexão com o servidor.</td></tr>';
        }
      }
      listarAlunos();
    </script>
  </body>
</html>
